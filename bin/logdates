#!/bin/sh
# 1.01 arb Tue Oct 26 14:04:54 BST 2010 - rewritten in perl and added
#      support for ingest.log
# This command changes "on Thu May 28 13:47:16 2009" at the end of the line
# into "2009 05 28 Thu 13:47:16" at the start of the line.
# Easier to view such log files and can be sorted numerically.
# 's/ on \([A-Z][a-z][a-z]\) May \([0-2 ][0-9]\) \([0-2][0-9]:[0-5][0-9]:[0-5][0-9]\) \([12][0-9][0-9][0-9]\)/ on \4 05 \2 (\1) \3/'
# (need one for each month).
# It also prepends the date+time to the lines which the ingest program
# writes to ingest.log containing the configuration and the txt files.

perl -n \
 -e 'chomp;' \
 -e 's/^(.*) on ([A-Z][a-z][a-z]) Jan ([0-2 ]\d) ([0-2]\d:[0-5]\d:[0-5]\d) ([12]\d\d\d)$/$5 01 $3 $2 $4 $1/;' \
 -e 's/^(.*) on ([A-Z][a-z][a-z]) Feb ([0-2 ]\d) ([0-2]\d:[0-5]\d:[0-5]\d) ([12]\d\d\d)$/$5 02 $3 $2 $4 $1/;' \
 -e 's/^(.*) on ([A-Z][a-z][a-z]) Mar ([0-2 ]\d) ([0-2]\d:[0-5]\d:[0-5]\d) ([12]\d\d\d)$/$5 03 $3 $2 $4 $1/;' \
 -e 's/^(.*) on ([A-Z][a-z][a-z]) Apr ([0-2 ]\d) ([0-2]\d:[0-5]\d:[0-5]\d) ([12]\d\d\d)$/$5 04 $3 $2 $4 $1/;' \
 -e 's/^(.*) on ([A-Z][a-z][a-z]) May ([0-2 ]\d) ([0-2]\d:[0-5]\d:[0-5]\d) ([12]\d\d\d)$/$5 05 $3 $2 $4 $1/;' \
 -e 's/^(.*) on ([A-Z][a-z][a-z]) Jun ([0-2 ]\d) ([0-2]\d:[0-5]\d:[0-5]\d) ([12]\d\d\d)$/$5 06 $3 $2 $4 $1/;' \
 -e 's/^(.*) on ([A-Z][a-z][a-z]) Jul ([0-2 ]\d) ([0-2]\d:[0-5]\d:[0-5]\d) ([12]\d\d\d)$/$5 07 $3 $2 $4 $1/;' \
 -e 's/^(.*) on ([A-Z][a-z][a-z]) Aug ([0-2 ]\d) ([0-2]\d:[0-5]\d:[0-5]\d) ([12]\d\d\d)$/$5 08 $3 $2 $4 $1/;' \
 -e 's/^(.*) on ([A-Z][a-z][a-z]) Sep ([0-2 ]\d) ([0-2]\d:[0-5]\d:[0-5]\d) ([12]\d\d\d)$/$5 09 $3 $2 $4 $1/;' \
 -e 's/^(.*) on ([A-Z][a-z][a-z]) Oct ([0-2 ]\d) ([0-2]\d:[0-5]\d:[0-5]\d) ([12]\d\d\d)$/$5 10 $3 $2 $4 $1/;' \
 -e 's/^(.*) on ([A-Z][a-z][a-z]) Nov ([0-2 ]\d) ([0-2]\d:[0-5]\d:[0-5]\d) ([12]\d\d\d)$/$5 11 $3 $2 $4 $1/;' \
 -e 's/^(.*) on ([A-Z][a-z][a-z]) Dec ([0-2 ]\d) ([0-2]\d:[0-5]\d:[0-5]\d) ([12]\d\d\d)$/$5 12 $3 $2 $4 $1/;' \
 -e 'if (/ingest: Dumping contents/) { $ingestdate=$_; $ingestdate =~ s/ingest:.*//; }' \
 -e 'if (/ingest: Ready to ingest/) { $ingestdate=$_; $ingestdate =~ s/ingest:.*//; }' \
 -e 'if (/^Date:/ || /^Sat:/ || /^Dirn:/ || /^Eqxt:/ || /^Eqxw:/ || /^OHtime:/ || /^Orbitnum:/ || /^Ident:/ || /^Numlines:/ || /^Avr.Alt:/ || /^Firstline/ || /^Lastline/ || /^Duration/ || /^EqxT/ || /^Horiz/ || /^Ohead/ || /^Delay/ || /^Format/ || /^Bad-lines/ || /^CD-Ident/) { $_=$ingestdate.$_; }' \
 -e 'if (/^Configuration:/ || /^Sched:/ || /^Input:/ || /^Output:/ || /^Sync:/) { $_=$ingestdate.$_; }' \
 -e 'print"$_\n";'
